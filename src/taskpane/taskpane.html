<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ExcelJax Task Pane</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 2vw; max-width: 520px; }
    label { font-weight: 500; }
    section { margin-bottom: 24px; }
    textarea, input, select, button {
      width: 100%; box-sizing: border-box; margin-bottom: 8px;
    }
    .row-btns { display: flex; gap: 8px; margin-bottom: 8px; }
    .row-btns button { flex: 1 1 0; }
    .result-box, #topChatOutput {
      border: 1px solid #ccc; min-height: 48px; padding: 8px; background: #fcfcfc; margin-bottom: 4px;
      white-space: pre-line;
    }
    #spinner, .spinner { display: none; margin-left: 8px; vertical-align: middle; }
    #modelError, .error-msg { color: #c00; font-size: 0.97em; margin-bottom: 8px; }
    .section-title { font-size: 1.12em; margin-bottom: 8px; margin-top: 0; }
    @media (max-width: 600px) {
      body { margin: 2vw; }
      .section-title { font-size: 1em; }
    }
    .subsection { margin-bottom: 12px; }
  </style>
</head>
<body>
  <!-- Top Chat Box -->
  <section>
    <div class="section-title">AI Chat</div>
    <input id="topChatInput" type="text" placeholder="Ask any question (e.g. 'Explain recursion')"/>
    <button id="topChatSendBtn" type="button">Ask</button>
    <span class="spinner" id="topChatSpinner">⏳</span>
    <div id="topChatOutput" class="result-box"></div>
  </section>

  <!-- Model Selection (for LLM-backed features) -->
  <section>
    <div class="section-title">LLM Model</div>
    <label for="modelDropdown">Choose model <span id="spinner">⏳</span></label>
    <select id="modelDropdown" disabled>
      <option>Loading models...</option>
    </select>
    <div id="modelError" class="error-msg"></div>
    <input id="systemMessage" type="text" placeholder="System message (optional, e.g. 'Be concise')"/>
  </section>

  <!-- Formula and Function Tools -->
  <section>
    <div class="section-title">Formula & Function Tools</div>
    <div class="subsection">
      <label>Replace selection with formulas</label>
      <input id="formulaPrompt" type="text" placeholder="e.g. 'calculate 10 percent of column B'"/>
      <button id="replaceFormulaBtn" type="button">Generate & Replace</button>
      <span class="spinner" id="replaceFormulaSpinner">⏳</span>
      <div id="replaceFormulaOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Explain formulas in selection</label>
      <button id="explainFormulaBtn" type="button">Explain</button>
      <span class="spinner" id="explainFormulaSpinner">⏳</span>
      <div id="explainFormulaOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Fix broken formulas</label>
      <button id="fixFormulaBtn" type="button">Fix Errors</button>
      <span class="spinner" id="fixFormulaSpinner">⏳</span>
      <div id="fixFormulaOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Simplify formulas</label>
      <button id="simplifyFormulaBtn" type="button">Simplify</button>
      <span class="spinner" id="simplifyFormulaSpinner">⏳</span>
      <div id="simplifyFormulaOutput" class="result-box"></div>
    </div>
  </section>

  <!-- Insights and Summarization -->
  <section>
    <div class="section-title">Insights & Summarization</div>
    <div class="subsection">
      <label>Summarize selected data</label>
      <button id="summarizeDataBtn" type="button">Summarize</button>
      <span class="spinner" id="summarizeDataSpinner">⏳</span>
      <div id="summarizeDataOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Generate key takeaways</label>
      <button id="keyTakeawaysBtn" type="button">Generate</button>
      <span class="spinner" id="keyTakeawaysSpinner">⏳</span>
      <div id="keyTakeawaysOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Flag unusual values</label>
      <button id="flagUnusualBtn" type="button">Flag</button>
      <span class="spinner" id="flagUnusualSpinner">⏳</span>
      <div id="flagUnusualOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Suggest visualization type</label>
      <button id="suggestVizBtn" type="button">Suggest</button>
      <span class="spinner" id="suggestVizSpinner">⏳</span>
      <div id="suggestVizOutput" class="result-box"></div>
    </div>
  </section>

  <!-- Cleanup and Formatting -->
  <section>
    <div class="section-title">Cleanup & Formatting</div>
    <div class="subsection">
      <label>Clean inconsistent values</label>
      <button id="cleanValuesBtn" type="button">Clean</button>
      <span class="spinner" id="cleanValuesSpinner">⏳</span>
      <div id="cleanValuesOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Remove duplicates or blanks</label>
      <button id="removeDupesBtn" type="button">Remove</button>
      <span class="spinner" id="removeDupesSpinner">⏳</span>
      <div id="removeDupesOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Recommend conditional formatting</label>
      <button id="condFormatBtn" type="button">Recommend</button>
      <span class="spinner" id="condFormatSpinner">⏳</span>
      <div id="condFormatOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Reformat column headers</label>
      <button id="reformatHeadersBtn" type="button">Reformat</button>
      <span class="spinner" id="reformatHeadersSpinner">⏳</span>
      <div id="reformatHeadersOutput" class="result-box"></div>
    </div>
  </section>

  <!-- Table and Text Tools -->
  <section>
    <div class="section-title">Table & Text Tools</div>
    <div class="subsection">
      <label>Describe table structure</label>
      <button id="describeTableBtn" type="button">Describe</button>
      <span class="spinner" id="describeTableSpinner">⏳</span>
      <div id="describeTableOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Autofill descriptions</label>
      <button id="autofillDescBtn" type="button">Autofill</button>
      <span class="spinner" id="autofillDescSpinner">⏳</span>
      <div id="autofillDescOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Generate dropdown values</label>
      <button id="dropdownValuesBtn" type="button">Generate</button>
      <span class="spinner" id="dropdownValuesSpinner">⏳</span>
      <div id="dropdownValuesOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Convert text to table</label>
      <textarea id="textToTableInput" rows="2" placeholder="Paste unstructured text here"></textarea>
      <button id="textToTableBtn" type="button">Convert</button>
      <span class="spinner" id="textToTableSpinner">⏳</span>
      <div id="textToTableOutput" class="result-box"></div>
    </div>
  </section>

  <!-- Advanced Excel Use Cases -->
  <section>
    <div class="section-title">Advanced Excel Tools</div>
    <div class="subsection">
      <label>Suggest PivotTable structure</label>
      <button id="suggestPivotBtn" type="button">Suggest</button>
      <span class="spinner" id="suggestPivotSpinner">⏳</span>
      <div id="suggestPivotOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Name ranges from selection</label>
      <input id="nameRangeInput" type="text" placeholder="Range name (optional)"/>
      <button id="nameRangeBtn" type="button">Name</button>
      <span class="spinner" id="nameRangeSpinner">⏳</span>
      <div id="nameRangeOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Add helper columns</label>
      <input id="helperColPrompt" type="text" placeholder="Describe the helper column (e.g., 'flag overdue tasks')"/>
      <button id="addHelperColBtn" type="button">Add</button>
      <span class="spinner" id="addHelperColSpinner">⏳</span>
      <div id="addHelperColOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Predict missing data</label>
      <button id="predictMissingBtn" type="button">Predict</button>
      <span class="spinner" id="predictMissingSpinner">⏳</span>
      <div id="predictMissingOutput" class="result-box"></div>
    </div>
  </section>

  <!-- Language and Communication -->
  <section>
    <div class="section-title">Language & Communication</div>
    <div class="subsection">
      <label>Translate selection</label>
      <input id="translateLangInput" type="text" placeholder="Target language (e.g., Spanish)"/>
      <button id="translateBtn" type="button">Translate</button>
      <span class="spinner" id="translateSpinner">⏳</span>
      <div id="translateOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Write summary from data</label>
      <button id="writeSummaryBtn" type="button">Summarize</button>
      <span class="spinner" id="writeSummarySpinner">⏳</span>
      <div id="writeSummaryOutput" class="result-box"></div>
    </div>
    <div class="subsection">
      <label>Add comments to cells</label>
      <button id="addCommentsBtn" type="button">Add Comments</button>
      <span class="spinner" id="addCommentsSpinner">⏳</span>
      <div id="addCommentsOutput" class="result-box"></div>
    </div>
  </section>

  <!-- Productivity and UX -->
  <section>
    <div class="row-btns">
      <button id="resetBtn" type="button">Reset All</button>
    </div>
    <div id="globalError" class="error-msg"></div>
  </section>

  <script src="taskpane.js"></script>
</body>
</html>
