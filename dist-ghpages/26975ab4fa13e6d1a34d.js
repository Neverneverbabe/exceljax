/*! For license information please see 26975ab4fa13e6d1a34d.js.LICENSE.txt */
function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof c?r:c,u=Object.create(s.prototype);return _regeneratorDefine2(u,"_invoke",function(n,r,o){var a,c,s,u=0,l=o||[],f=!1,m={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,c=0,s=e,m.n=n,i}};function p(n,r){for(c=n,s=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=m.p,g=a[2];n>3?(o=g===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(c=0,m.v=r,m.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,m.n=g,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,g),c=l,s=g;(t=c<2?e:s)||!f;){a||(c?c<3?(c>1&&(m.n=-1),p(c,s)):m.n=s:m.v=s);try{if(u=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=m.n<0)?s:n.call(r,m))!==i)break}catch(t){a=e,c=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function c(){}function s(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,(function(){return this})),t),f=u.prototype=c.prototype=Object.create(l);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,_regeneratorDefine2(f,"constructor",u),_regeneratorDefine2(u,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(u,o,"GeneratorFunction"),_regeneratorDefine2(f),_regeneratorDefine2(f,o,"Generator"),_regeneratorDefine2(f,r,(function(){return this})),_regeneratorDefine2(f,"toString",(function(){return"[object Generator]"})),(_regenerator=function(){return{w:a,m:m}})()}function _regeneratorDefine2(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){_regeneratorDefine2(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},_regeneratorDefine2(e,t,n,r)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){asyncGeneratorStep(a,r,o,i,c,"next",e)}function c(e){asyncGeneratorStep(a,r,o,i,c,"throw",e)}i(void 0)}))}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var statusElem,defaultConfig={endpoint:"http://localhost:4321/v1/completions",model:"meta-llama-3.1-8b-instruct"},config=_objectSpread(_objectSpread({},defaultConfig),JSON.parse(localStorage.getItem("llmConfig")||"{}")),conversationHistory=[];function saveConfig(){localStorage.setItem("llmConfig",JSON.stringify(config))}function updateInputsFromConfig(){document.getElementById("endpointInput").value=config.endpoint,document.getElementById("modelInput").value=config.model}function sendToLLM(e){return _sendToLLM.apply(this,arguments)}function _sendToLLM(){return(_sendToLLM=_asyncToGenerator(_regenerator().m((function e(t){var n,r,o,a;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch(config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:config.model,prompt:t,max_tokens:200,temperature:.7})}).catch((function(e){throw console.error("❌ Fetch error:",e),e}));case 1:return o=e.v,e.n=2,o.json().catch((function(e){throw console.error("❌ Invalid JSON:",e),e}));case 2:if(a=e.v,null===(n=a.choices)||void 0===n||null===(n=n[0])||void 0===n||!n.text){e.n=3;break}return e.a(2,a.choices[0].text.trim());case 3:if(null===(r=a.choices)||void 0===r||null===(r=r[0])||void 0===r||null===(r=r.message)||void 0===r||!r.content){e.n=4;break}return e.a(2,a.choices[0].message.content.trim());case 4:return e.a(2,"⚠ No valid response format found from LLM.");case 5:return e.a(2)}}),e)})))).apply(this,arguments)}function analyzeSelectedCells(){return _analyzeSelectedCells.apply(this,arguments)}function _analyzeSelectedCells(){return _analyzeSelectedCells=_asyncToGenerator(_regenerator().m((function e(){var t;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m((function e(t){var n,r,o,a;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.getSelectedRange()).load("values"),e.n=1,t.sync();case 1:return r=n.values,o="Analyze the following Excel data and provide summaries, patterns, or suggestions:\n\n".concat(JSON.stringify(r)),statusElem.textContent="",e.n=2,sendToLLM(o);case 2:return a=e.v,n.getOffsetRange(r.length+1,0).getCell(0,0).values=[[a]],e.n=3,t.sync();case 3:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ Error in analyzeSelectedCells:",t),statusElem&&(statusElem.textContent="Error communicating with LLM");case 3:return e.a(2)}}),e,null,[[0,2]])}))),_analyzeSelectedCells.apply(this,arguments)}function chatWithAI(){return _chatWithAI.apply(this,arguments)}function _chatWithAI(){return(_chatWithAI=_asyncToGenerator(_regenerator().m((function e(){var t,n,r,o;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:if(e.p=0,t=document.getElementById("promptInput").value.trim()){e.n=1;break}return e.a(2);case 1:return(n=document.getElementById("chatOutput")).textContent="Thinking...",statusElem.textContent="",conversationHistory.push("User: ".concat(t)),e.n=2,sendToLLM(conversationHistory.join("\n"));case 2:r=e.v,conversationHistory.push("Assistant: ".concat(r)),n.textContent=r,e.n=4;break;case 3:e.p=3,o=e.v,console.error("❌ Error in chatWithAI:",o),statusElem&&(statusElem.textContent="Error communicating with LLM");case 4:return e.a(2)}}),e,null,[[0,3]])})))).apply(this,arguments)}function analyzeEntireSheet(){return _analyzeEntireSheet.apply(this,arguments)}function _analyzeEntireSheet(){return _analyzeEntireSheet=_asyncToGenerator(_regenerator().m((function e(){var t;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m((function e(t){var n,r,o,a,i;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return n=t.workbook.worksheets.getActiveWorksheet(),(r=n.getUsedRange()).load("values"),e.n=1,t.sync();case 1:return o="Summarize the following worksheet data:\n\n".concat(JSON.stringify(r.values)),statusElem.textContent="",e.n=2,sendToLLM(o);case 2:return a=e.v,(i=t.workbook.worksheets.add("LLM Summary")).getRange("A1").values=[[a]],i.activate(),e.n=3,t.sync();case 3:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ Error in analyzeEntireSheet:",t),statusElem&&(statusElem.textContent="Error communicating with LLM");case 3:return e.a(2)}}),e,null,[[0,2]])}))),_analyzeEntireSheet.apply(this,arguments)}function suggestFormulaForSelectedCells(){return _suggestFormulaForSelectedCells.apply(this,arguments)}function _suggestFormulaForSelectedCells(){return _suggestFormulaForSelectedCells=_asyncToGenerator(_regenerator().m((function e(){var t;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m((function e(t){var n,r,o,a;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.getSelectedRange()).load("address"),e.n=1,t.sync();case 1:if(r=document.getElementById("promptInput").value.trim()){e.n=2;break}return e.a(2);case 2:return o="Provide an Excel formula only for: ".concat(r),statusElem.textContent="",e.n=3,sendToLLM(o);case 3:return a=e.v,n.formulas=[[a]],e.n=4,t.sync();case 4:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ Error in suggestFormulaForSelectedCells:",t),statusElem&&(statusElem.textContent="Error communicating with LLM");case 3:return e.a(2)}}),e,null,[[0,2]])}))),_suggestFormulaForSelectedCells.apply(this,arguments)}function improveExistingFormula(){return _improveExistingFormula.apply(this,arguments)}function _improveExistingFormula(){return _improveExistingFormula=_asyncToGenerator(_regenerator().m((function e(){var t;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m((function e(t){var n,r,o,a,i,c,s,u,l,f,m;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.getSelectedRange()).load("formulas"),e.n=1,t.sync();case 1:return r=n.formulas,o="Improve or simplify these formulas. Return them in the same order separated by new lines:\n".concat(JSON.stringify(r)),statusElem.textContent="",e.n=2,sendToLLM(o);case 2:if(a=e.v,i=a.split(/\r?\n/).filter((function(e){return e.trim().length>0})),c=r.length,s=r[0].length,i.length===c*s){for(u=[],l=0,f=0;f<c;f++)for(u[f]=[],m=0;m<s;m++)u[f][m]=i[l++]||r[f][m];n.formulas=u}else 1===i.length&&1===c&&1===s&&(n.formulas=[[i[0]]]);return e.n=3,t.sync();case 3:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ Error in improveExistingFormula:",t),statusElem&&(statusElem.textContent="Error communicating with LLM");case 3:return e.a(2)}}),e,null,[[0,2]])}))),_improveExistingFormula.apply(this,arguments)}function createVisualsBasedOnData(){return _createVisualsBasedOnData.apply(this,arguments)}function _createVisualsBasedOnData(){return _createVisualsBasedOnData=_asyncToGenerator(_regenerator().m((function e(){var t;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m((function e(t){var n,r,o,a,i;return _regenerator().w((function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.getSelectedRange()).load(["values","rowCount","columnCount"]),e.n=1,t.sync();case 1:return r="Suggest the best chart type for this data: ".concat(JSON.stringify(n.values)),statusElem.textContent="",e.n=2,sendToLLM(r);case 2:return o=e.v,a="ColumnClustered",(i=o.toLowerCase()).includes("line")?a="Line":i.includes("pie")?a="Pie":i.includes("bar")?a="BarClustered":i.includes("scatter")&&(a="XYScatter"),t.workbook.worksheets.getActiveWorksheet().charts.add(a,n,Excel.ChartSeriesBy.columns).setPosition(n.getOffsetRange(n.rowCount+1,0),n.getOffsetRange(n.rowCount+15,n.columnCount)),e.n=3,t.sync();case 3:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ Error in createVisualsBasedOnData:",t),statusElem&&(statusElem.textContent="Error communicating with LLM");case 3:return e.a(2)}}),e,null,[[0,2]])}))),_createVisualsBasedOnData.apply(this,arguments)}Office.onReady((function(e){e.host===Office.HostType.Excel&&(document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",document.getElementById("chatBtn").onclick=chatWithAI,document.getElementById("analyzeSelectionBtn").onclick=analyzeSelectedCells,document.getElementById("analyzeSheetBtn").onclick=analyzeEntireSheet,document.getElementById("suggestFormulaBtn").onclick=suggestFormulaForSelectedCells,document.getElementById("improveFormulaBtn").onclick=improveExistingFormula,document.getElementById("createVisualsBtn").onclick=createVisualsBasedOnData,document.getElementById("saveSettingsBtn").onclick=function(){config.endpoint=document.getElementById("endpointInput").value.trim()||defaultConfig.endpoint,config.model=document.getElementById("modelInput").value.trim()||defaultConfig.model,saveConfig()},statusElem=document.getElementById("status"),updateInputsFromConfig())}));
